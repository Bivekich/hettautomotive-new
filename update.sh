#!/bin/bash

# Устанавливаем права на выполнение
chmod +x update.sh

echo "Начинаю обновление приложения..."

# Получаем последнюю версию кода
echo "Получение последних изменений из репозитория..."
git pull

# Останавливаем только контейнер с приложением, не удаляя тома
echo "Остановка приложения..."
docker-compose stop app

# Пересоздание контейнера с приложением без удаления томов
echo "Пересборка образа приложения..."
docker-compose build app --no-cache

# Запуск приложения
echo "Запуск обновленного приложения..."
docker-compose up -d app

# Проверка статуса
echo "Проверка статуса контейнера..."
docker-compose ps app

echo "Обновление завершено! Приложение запущено с сохранением всех загруженных файлов."
echo "Логи доступны командой: docker-compose logs -f app" 